var BLOCK_SIDE_PIXEL_COUNT=20,MAP_WIDTH_IN_BLOCKS=144,MAP_HEIGHT_IN_BLOCKS=88,GRID_BORDER_PIXEL_COUNT=BLOCK_SIDE_PIXEL_COUNT/10,road_objects=[],farm_objects=[],city_objects=[],unit_objects=[],wonder_objects=[],canvas=document.getElementById("mapCanvas"),ctx=canvas.getContext("2d"),mapID=document.getElementById("mapImage");function generateMetaContent(e){var t="";t+='                                                     <div class="row">                                                       <div class="input-field col s6">                                        <select class="metaPlayerCount">                                        <option value="4">4</option>                                        <option value="3">3</option>                                        <option value="2">2</option>                                    </select>                                                           <label>Number of Players:</label>                               </div>                                                              <div class="input-field col s6">                                        <select class="metaAnarchyEnabled">                                     <option value="true">true</option>                                  <option value="false">false</option>                            </select>                                                           <label>Enable Anarchy? (Barbarians):</label>                    </div>                                                          </div>                                                              ',t+='                                                     <ul class="tabs tabs-fixed-width z-depth-1 player-tabs">                <li class="tab">                                                        <a href="#tabPlayer1" class="active">1</a>                      </li>                                                               <li class="tab">                                                        <a href="#tabPlayer2">2</a>                                     </li>                                                               <li class="tab">                                                        <a href="#tabPlayer3">3</a>                                     </li>                                                               <li class="tab">                                                        <a href="#tabPlayer4">4</a>                                     </li>                                                               <li class="tab">                                                        <a href="#tabPlayer5">Anarchy</a>                               </li>                                                               <li class="tab">                                                        <a href="#tabNature">Nature</a>                                 </li>                                                           </ul>                                                               ';for(var o=1;o<=5;o++){for(var a=Date.now();Date.now()==a;);t+='                                                         <div id="tabPlayer'+o+'">'+('                                                       <br>                                                                <div class="row">                                                       <div class="input-field col s6">                                        <input id="playerName_'+a+'"                                 class="playerName" type="text" maxlength="64">                      <label for="playerName_'+a+'">                                   Player Name:                                                    </label>                                                        </div>                                                              <div class="input-field col s6">                                        <select class="playerType">'+(5==o?'<option value="3">Anarchy</option>':'<option value="1">Human</option>                                   <option value="2">Computer</option>')+'</select>                                                          <label>Player Type:</label>                                     </div>                                                              <div class="input-field col s6">                                        <select class="playerCivilization">'+(5==o?'<option value="6">Barbarian</option>':'<option value="0">Greek</option>                                   <option value="1">Egyptian</option>                                 <option value="2">Indian</option>                                   <option value="3">Mesopotamian</option>                             <option value="4">Chinese</option>                                  <option value="5">Celt</option>                                     <option value="6">Barbarian</option>')+'</select>                                                          <label>Nation:</label>                                          </div>                                                              <div class="input-field col s6">                                        <select class="playerMapExplored">                                      <option value="true">yes</option>                                   <option value="false">no</option>                               </select>                                                           <label>Map Fully Explored:</label>                              </div>                                                          </div>                                                                                                                                  <p>Select and configure object.                                     Then click on map to place.</p>                                                                                                         <ul class="tabs tabs-fixed-width z-depth-1 obj-tabs">                   <li class="tab">                                                        <a href="#tabCity_'+a+'" class="active">                         city                                                            </a>                                                            </li>                                                               <li class="tab">                                                        <a href="#tabUnit_'+a+'">                                        unit                                                            </a>                                                            </li>                                                           </ul>                                                                                                                                   <div id="tabCity_'+a+'">                                         <div class="row">                                                       <div class="input-field col s12">                                       <input id="cityName_'+a+'"                                   class="cityName" type="text" maxlength="64">                        <label for="cityName_'+a+'">                                     City Name:                                                      </label>                                                        </div>                                                                                                                                  <p>All Buildings</p>                                                <div class="switch">                                                    <label>                                                                 false                                                               <input type="checkbox"                                              class="cityAllBuildings">                                           <span class="lever"></span>                                         true                                                            </label>                                                        </div>                                                                                                                                  <p>All Knowledge</p>                                                <div class="switch">                                                    <label>                                                                 false                                                               <input type="checkbox"                                              class="cityAllKnowledge">                                           <span class="lever"></span>                                         true                                                            </label>                                                        </div>                                                          </div>                                                          </div>                                                              <div id="tabUnit_'+a+'">                                         <br>                                                                <div class="row">                                                       <div class="input-field col s6">                                        <select class="unitType">                                           <option value="500a">Light Missle</option>                          <option value="6006">Heavy Missle</option>                          <option value="000a">Light Infantry</option>                        <option value="10O8">Medium Infantry</option>                       <option value="21O6">Heavy Infantry</option>                        <option value="30Oe">Light Calvary</option>                         <option value="40OC">Heavy Calvary</option>                         <option value="d207">Jungle Raider</option>                         <option value="c30c">Desert Raider</option>                         <option value="70Og">Light Ship</option>                            <option value="81Ok">Heavy Ship</option>                            <option value="91Oa">Philosopher</option>                           <option value="b0Oa">Merchant</option>                              <option value="a0Oa">Settler</option>                               </select>                                                           <label>Unit Type:</label>                                       </div>                                                              <div class="input-field col s6">                                        <select class="unitCount">                                          <option value="1">1</option>                                        <option value="2">2</option>                                        <option value="3">3</option>                                        <option value="4">4</option>                                        <option value="5">5</option>                                        <option value="10">10</option>                                      <option value="20">20</option>                                      <option value="25">25</option>                                      <option value="27">27</option>                                      </select>                                                           <label>Unit Count:</label>                                      </div>                                                          </div>                                                          </div>                                                              ')+"                      </div>                                                          "}t+='                                                     <div id="tabNature">                                                    <p>Select and configure object.                                     Then click on map to place.</p>                                                                                                         <ul class="tabs tabs-fixed-width z-depth-1 obj-tabs">                   <li class="tab">                                                        <a href="#tabRoad_'+a+'" class="active">                         road                                                            </a>                                                            </li>                                                               <li class="tab">                                                        <a href="#tabFarm_'+a+'">                                        farm                                                            </a>                                                            </li>                                                               <li class="tab">                                                        <a href="#tabWonder_'+a+'">                                      wonder                                                          </a>                                                            </li>                                                           </ul>                                                               <br>                                                                <div id="tabWonder_'+a+'">                                       <br>                                                                <div class="row">                                                       <div class="input-field col s6">                                        <select class="wonderCivilization">                                 <option value="0">Greek</option>                                    <option value="1">Egyptian</option>                                 <option value="2">Indian</option>                                   <option value="3">Mesopotamian</option>                             <option value="4">Chinese</option>                                  <option value="5">Celt</option>                                     </select>                                                           <label>Civilization:</label>                                    </div>                                                          </div>                                                          </div>                                                          </div>                                                              ',$(e).prepend(t)}function renderCanvasImage(){var e;ctx.drawImage(mapID,0,0);for(var t=0;t<city_objects.length;t++)e=city_objects[t].coords,ctx.fillStyle=getObjectColor(city_objects[t].player).city,ctx.fillRect(e.cornerX+GRID_BORDER_PIXEL_COUNT+4,e.cornerY+GRID_BORDER_PIXEL_COUNT+4,10,10);for(t=0;t<unit_objects.length;t++)e=unit_objects[t].coords,ctx.fillStyle=getObjectColor(unit_objects[t].player).unit,ctx.fillRect(e.cornerX+GRID_BORDER_PIXEL_COUNT+5,e.cornerY+GRID_BORDER_PIXEL_COUNT+5,8,8);for(t=0;t<wonder_objects.length;t++)e=wonder_objects[t].coords,ctx.fillStyle=getObjectColor(wonder_objects[t].player).wonder,ctx.fillRect(e.cornerX+GRID_BORDER_PIXEL_COUNT+4,e.cornerY+GRID_BORDER_PIXEL_COUNT+4,10,10);for(t=0;t<farm_objects.length;t++)ctx.fillStyle=getObjectColor(farm_objects[t].player).farm,e=farm_objects[t].coords,ctx.fillRect(e.cornerX+GRID_BORDER_PIXEL_COUNT,e.cornerY+GRID_BORDER_PIXEL_COUNT,BLOCK_SIDE_PIXEL_COUNT-GRID_BORDER_PIXEL_COUNT,4),ctx.fillRect(e.cornerX+GRID_BORDER_PIXEL_COUNT,e.cornerY+GRID_BORDER_PIXEL_COUNT,4,BLOCK_SIDE_PIXEL_COUNT-GRID_BORDER_PIXEL_COUNT),ctx.fillRect(e.cornerX+(BLOCK_SIDE_PIXEL_COUNT-4),e.cornerY+GRID_BORDER_PIXEL_COUNT,4,BLOCK_SIDE_PIXEL_COUNT-GRID_BORDER_PIXEL_COUNT),ctx.fillRect(e.cornerX+GRID_BORDER_PIXEL_COUNT,e.cornerY+(BLOCK_SIDE_PIXEL_COUNT-4),BLOCK_SIDE_PIXEL_COUNT-GRID_BORDER_PIXEL_COUNT,4);for(t=0;t<road_objects.length;t++)ctx.fillStyle=getObjectColor(road_objects[t].player).road,e=road_objects[t].coords,ctx.fillRect(e.cornerX+GRID_BORDER_PIXEL_COUNT+8,e.cornerY+GRID_BORDER_PIXEL_COUNT,2,BLOCK_SIDE_PIXEL_COUNT-GRID_BORDER_PIXEL_COUNT),ctx.fillRect(e.cornerX+GRID_BORDER_PIXEL_COUNT,e.cornerY+GRID_BORDER_PIXEL_COUNT+8,BLOCK_SIDE_PIXEL_COUNT-GRID_BORDER_PIXEL_COUNT,2)}function indexOfObject(e,t,o){for(var a=-1,n=0;n<e.length;n++)if(e[n].coords.x==t&&e[n].coords.y==o){a=n;break}return a}function getObjectColor(e){var t={};switch(e){case 1:case"1":t.city="#FF0000",t.unit="#FF8888";break;case 2:case"2":t.city="#145A32",t.unit="#00FF00";break;case 3:case"3":t.city="#0000FF",t.unit="#5DADE2";break;case 4:case"4":t.city="#4A235A",t.unit="#A569BD";break;case 5:case"5":case"Anarchy":t.city="#000000",t.unit="#444444";break;case 6:case"6":case"Nature":t.road="#6E2C00",t.farm="#B7950B",t.wonder="#6E2C00"}return t}function getCityInfo(e){var t={};return t.name=$("#tabPlayer"+e+" .cityName").val(),""==t.name&&(t.name="Outpost"),t.developed=$("#tabPlayer"+e+" .cityAllBuildings").prop("checked"),t.knowledge=$("#tabPlayer"+e+" .cityAllKnowledge").prop("checked"),t}function getUnitInfo(e){var t={};return t.type=$("#tabPlayer"+e+" .unitType").val().trim(),t.count=$("#tabPlayer"+e+" .unitCount").val().trim(),t}function getWonderInfo(){var e={};return e.civilization=$("#tabNature .wonderCivilization").val().trim(),e}function convertOffsetsToCoords(e,t){var o={x:0,y:0,xy:0,cornerX:0,cornerY:0};return o.x=parseInt(e/BLOCK_SIDE_PIXEL_COUNT),o.y=parseInt(t/BLOCK_SIDE_PIXEL_COUNT),o.xy=o.y*MAP_WIDTH_IN_BLOCKS+o.x,o.cornerX=o.x*BLOCK_SIDE_PIXEL_COUNT,o.cornerY=o.y*BLOCK_SIDE_PIXEL_COUNT,o}function mapCanvasClickHandler(e,t){var o={coords:{},player:"",objType:""};o.coords=convertOffsetsToCoords(parseInt(e),parseInt(t)),o.player=$(".player-tabs .active").html().trim(),"Anarchy"==o.player&&(o.player="5"),"Nature"==o.player?o.objType=$("#tabNature .obj-tabs .active").html().trim():o.objType=$("#tabPlayer"+o.player+" .obj-tabs .active").html().trim();var a=null,n=-1;if("road"==o.objType)a=road_objects;else if("farm"==o.objType)a=farm_objects;else if("wonder"==o.objType)a=wonder_objects,o.wonder=getWonderInfo();else if("unit"==o.objType)a=unit_objects,o.unit=getUnitInfo(o.player);else{if("city"!=o.objType)return;a=city_objects,o.city=getCityInfo(o.player)}-1==(n=indexOfObject(a,o.coords.x,o.coords.y))?a.push(o):a.splice(n,1),renderCanvasImage()}function createButtonClickHandler(){var e=$(".metaPlayerCount").val().trim(),t=$(".metaAnarchyEnabled").val().trim();console.log(t);for(var o=[{},{},{},{},{}],a=0;a<5;a++)o[a].name=$("#tabPlayer"+(a+1)+" .playerName").val().trim(),""==o[a].name&&(o[a].name="Player "+(a+1)),o[a].type=$("#tabPlayer"+(a+1)+" .playerType").val().trim(),o[a].nation=$("#tabPlayer"+(a+1)+" .playerCivilization").val().trim(),o[a].exloredMap=$("#tabPlayer"+(a+1)+" .playerMapExplored").val().trim();var n,i="",l=["","","","",""],r="";i+="[Game]\r\nMap=Worldfin.map\r\nWhoseTurn=0\r\nScale=100\r\nRound=0\r\n";for(a=0;a<5;a++)i+="Player="+a+',"'+o[a].name+'",'+o[a].nation+","+o[a].type+","+o[a].nation+"\r\n";for(a=0;a<5;a++)i+="ID="+a+',"R&R Player"\r\n';i+="lost=0,0,"+(3<=e?"0":"1")+","+(4<=e?"0":"1")+","+("true"==t?"0":"1")+"\r\n";for(a=0;a<5;a++){i+="[Army"+a+"]\r\n";for(var c=0;c<unit_objects.length;c++){var s=(_=unit_objects[c]).player;if(parseInt(s)==a+1&&("500a"==_.unit.type||"6006"==_.unit.type||"000a"==_.unit.type||"10O8"==_.unit.type||"21O6"==_.unit.type||"30Oe"==_.unit.type||"40OC"==_.unit.type||"d207"==_.unit.type||"c30c"==_.unit.type)){i+=_.coords.xy+"=";for(var p=0;p<_.unit.count;p++)i+=_.unit.type;i+=",100,100,0\r\n"}}}for(a=0;a<5;a++){i+="[Philosopher"+a+"]\r\n";for(c=0;c<unit_objects.length;c++){s=(_=unit_objects[c]).player;if(parseInt(s)==a+1&&"91Oa"==_.unit.type)for(p=0;p<_.unit.count;p++)i+=_.coords.xy+"="+_.unit.type+',1000000,1000000,1000000,1000000,1000000,"test phil"\r\n'}}for(a=0;a<5;a++){i+="[Settler"+a+"]\r\n";for(c=0;c<unit_objects.length;c++){s=(_=unit_objects[c]).player;if(parseInt(s)==a+1&&"b0Oa"==_.unit.type)for(p=0;p<_.unit.count;p++)i+=_.coords.xy+"="+_.unit.type+",1000000,1000000,1000000,1000000,1000000\r\n"}}for(a=0;a<5;a++){i+="[Merchant"+a+"]\r\n";for(c=0;c<unit_objects.length;c++){s=(_=unit_objects[c]).player;if(parseInt(s)==a+1&&"a0Oa"==_.unit.type)for(p=0;p<_.unit.count;p++)i+=_.coords.xy+"="+_.unit.type+",1,1\r\n"}}for(a=0;a<5;a++){i+="[Ship"+a+"]\r\n";for(c=0;c<unit_objects.length;c++){s=(_=unit_objects[c]).player;if(parseInt(s)==a+1&&("70Og"==_.unit.type||"81Ok"==_.unit.type))for(p=0;p<_.unit.count;p++)i+=_.coords.xy+"="+_.unit.type+',"test ship"\r\n'}}for(a=0;a<5;a++)i+="[Orders"+a+"]\r\n";for(a=0;a<city_objects.length;a++){l[(s=(_=city_objects[a]).player)-1]+="[City"+(s-1)+"@"+_.coords.xy+']\r\ncity="'+_.city.name+'",'+(_.city.developed?"3":"1")+"\r\npop="+(_.city.developed?"2000":"300")+",0,0,z1a3,aaaaa,OO000\r\nknow="+(_.city.knowledge?"1000000,1000000,1000000,1000000,1000000":"0,0,0,0,0")+"\r\nprod=0,0,0\r\nbuilding="+(_.city.developed?"3":"1")+(s-1)+(_.city.developed?"3":"0")+(s-1)+(_.city.developed?"3":"0")+(s-1)+(_.city.developed?"3":"1")+(s-1)+(_.city.developed?"3":"0")+(s-1)+(_.city.developed?"3":"0")+(s-1)+(_.city.developed?"3":"0")+(s-1)+(_.city.developed?"3":"0")+(s-1)+(_.city.developed?"3":"0")+(s-1)+(_.city.developed?"3":"0")+(s-1)+"\r\ntrade=pppp,0,"+("1"==s?"B0000":"")+("2"==s?"0B000":"")+("3"==s?"00B00":"")+("4"==s?"000B0":"")+("5"==s?"0000B":"")+"\r\ngoods=0,0,0,0,0,0,0,0,0\r\norders=0,0,0\r\n"}for(a=0;a<5;a++)i+=l[a],l[a]="";for(a=0;a<5;a++)if(i+="[Spotted"+a+"]\r\n","true"==o[a].exloredMap)for(c=0;c<MAP_HEIGHT_IN_BLOCKS;c++)i+=c+"=ffffffffffffffffffffffffffffffffffff\r\n";for(a=0;a<5;a++){i+="[Diplomacy"+a+"]\r\n";for(c=0;c<5;c++)a!=c&&(i+="dip="+c+",51,51,0,0\r\n")}for(a=0;a<5;a++){i+="[CombatStats"+a+"]\r\n";for(c=0;c<5;c++)a!=c&&(i+="stats="+c+",0,0,0,0,0,0,0,0,0,0\r\n")}for(a=0;a<5;a++)i+="[EventStatus"+a+"]\r\n";i+="[Road]\r\n",r="";for(a=0;a<MAP_HEIGHT_IN_BLOCKS;a++)r+=a+"=000000000000000000000000000000000000\r\n";for(a=0;a<road_objects.length;a++){var d=road_objects[a].coords.x,u=road_objects[a].coords.y;n=r.indexOf(u+"="),n=r.indexOf("=",n)+1,n+=parseInt(d/4);var f=(parseInt(r[n],16)+Math.pow(2,parseInt(d%4))).toString(16);r=r.substring(0,n)+f+r.substring(n+1)}i+=r,i+="[Cultivation]\r\n",r="";for(a=0;a<MAP_HEIGHT_IN_BLOCKS;a++)r+=a+"=000000000000000000000000000000000000\r\n";for(a=0;a<farm_objects.length;a++){d=farm_objects[a].coords.x,u=farm_objects[a].coords.y;n=r.indexOf(u+"="),n=r.indexOf("=",n)+1,n+=parseInt(d/4);f=(parseInt(r[n],16)+Math.pow(2,parseInt(d%4))).toString(16);r=r.substring(0,n)+f+r.substring(n+1)}i+=r,i+="[Wonders]\r\n";for(a=0;a<wonder_objects.length;a++){var _;i+="w="+(_=wonder_objects[a]).wonder.civilization+",0,"+_.coords.xy+",0\r\n"}i+="[End]\r\n\r\n";var y=window.btoa(i);$("#downloadModal .modal-content").html('All Done!<br>Get file here:<br><a href="data:application/octet-stream;charset=utf-16le;base64,'+y+'">RiseAndRule.sav</a>'),$("#downloadModal").modal("open")}window.onload=function(){generateMetaContent($("#metaContent")),renderCanvasImage(),$(".tabs").tabs(),$("select").formSelect(),$(".modal").modal(),$("#mapCanvas").click(function(e){mapCanvasClickHandler(e.offsetX,e.offsetY)}),$("#btn_create").click(function(e){createButtonClickHandler()})};